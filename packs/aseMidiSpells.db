{"name":"Detect Magic","type":"spell","img":"systems/dnd5e/icons/spells/light-blue-2.jpg","data":{"description":{"value":"<p>For the duration, you sense the presence of magic within 30 feet of you. If you sense magic in this way, you can use your action to see a faint aura around any visible creature or object in the area that bears magic, and you learn its school of magic, if any.</p>\n<p>The spell can penetrate most barriers, but it is blocked by 1 foot of stone, 1 inch of common metal, a thin sheet of lead, or 3 feet of wood or dirt.</p>","chat":"<p>For the duration, you sense the presence of magic within 30 feet of you. If you sense magic in this way, you can use your action to see a faint aura around any visible creature or object in the area that bears magic, and you learn its school of magic, if any.</p>\n<p>The spell can penetrate most barriers, but it is blocked by 1 foot of stone, 1 inch of common metal, a thin sheet of lead, or 3 feet of wood or dirt.</p>","unidentified":""},"source":"Basic Rules, Player's Handbook pg 231","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"div","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":true,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"FEWmZGWq8JJmEjb4":3},"flags":{"ddbimporter":{"id":136561,"definitionId":2065,"entityTypeId":435869154,"dndbeyond":{"lookup":"generic","lookupName":"generic","level":null,"castAtLevel":null},"sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":231,"sourceType":1}],"tags":["Detection"]},"betterRolls5e":{"quickVersatile":{"altValue":true},"quickCharges":{"value":{"use":true,"resource":true},"altValue":{"use":true,"resource":true}}},"cf":{"id":"temp_b2nw42skn5p"},"core":{"sourceId":"Compendium.world.ddb-candlekeep-adventures-spells.FavliCsUSB9IGttT"},"enhancedcombathud":{"set1p":false,"set2p":false,"set3p":false},"targetreacts":{"shakeDelay":""},"midi-qol":{"onUseMacroName":"ItemMacro"},"advancedspelleffects":{"enableASE":true,"effectOptions":{"waveColor":"blue","auraColor":"blue"}},"itemacro":{"macro":{"data":{"command":"/*ASE_REPLACED*/if(args[0] === \"off\"){\nlet midiData = args[args.length-1];\nlet caster = canvas.tokens.get(midiData.tokenId);\nlet users = [];\nfor (const user in game.actors.get(midiData.actorId).data.permission) {\nif (user == \"default\") continue;\nusers.push(user);\n}\nlet objects = await Tagger.getByTag(\"magical\", { ignore: [caster] });\nlet magicalSchools = Object.values(CONFIG.DND5E.spellSchools).map(school => school.toLowerCase());\nlet magicalColors = [\"blue\", \"green\", \"pink\", \"purple\", \"red\", \"yellow\"];\nlet magicalObjects = [];\n\nmagicalObjects = objects.map(o => {\n            let distance = canvas.grid.measureDistance(caster, o);\n            return {\n                delay: 0,\n                distance: distance,\n                obj: o,\n                school: Tagger.getTags(o).find(t => magicalSchools.includes(t.toLowerCase())) || false,\n                color: Tagger.getTags(o).find(t => magicalColors.includes(t.toLowerCase())) || \"blue\"\n            }\n        })\n        for (let magical of magicalObjects) {\n            if (!magical.school) {\n                continue;\n            }\n            await game.AdvancedSpellEffects.updateFlag(magical.obj.id, \"magicDetected\", false);\n            Sequencer.EffectManager.endEffects({name: `${magical.obj.document.id}-magicRune`, object: magical.obj});\n            Sequencer.EffectManager.endEffects({name: `${caster.id}-detectMagicAura`, object: caster});\n            new Sequence(\"Advanced Spell Effects\")\n                .effect(\"jb2a.magic_signs.rune.{{school}}.outro.{{color}}\")\n                .forUsers(users)\n                .atLocation(magical.obj)\n                .scale(0.25)\n                .setMustache(magical)\n                .zIndex(0)\n                .effect()\n                .file(\"jb2a.magic_signs.circle.02.divination.outro.blue\")\n                .scale(0.2)\n                .belowTokens()\n                .attachTo(caster)\n            .play()\n        }\n}\nelse if(args[0] != \"on\" && args[0] != \"off\"){\nlet options = {version: \"MIDI\", args: args, waveColor: \"blue\", auraColor: \"blue\"};\ngame.AdvancedSpellEffects.detectMagic(options);\n}","name":"Detect Magic"}}}},"_id":"4DrhBocpi87SUKQI"}
{"name":"Darkness","type":"spell","img":"systems/dnd5e/icons/spells/evil-eye-red-2.jpg","data":{"description":{"value":"<p>Magical darkness spreads from a point you choose within range to fill a 15-foot-radius sphere for the duration. The darkness spreads around corners. A creature with darkvision can't see through this darkness, and nonmagical light can't illuminate it.</p>\n<p>If the point you choose is on an object you are holding or one that isn't being worn or carried, the darkness emanates from the object and moves with it. Completely covering the source of the darkness with an opaque object, such as a bowl or a helm, blocks the darkness.</p>\n<p>If any of this spell's area overlaps with an area of light created by a spell of 2nd level or lower, the spell that created the light is dispelled.</p>","chat":"<p>Magical darkness spreads from a point you choose within range to fill a 15-foot-radius sphere for the duration. The darkness spreads around corners. A creature with darkvision can't see through this darkness, and nonmagical light can't illuminate it.</p>\n<p>If the point you choose is on an object you are holding or one that isn't being worn or carried, the darkness emanates from the object and moves with it. Completely covering the source of the darkness with an opaque object, such as a bowl or a helm, blocks the darkness.</p>\n<p>If any of this spell's area overlaps with an area of light created by a spell of 2nd level or lower, the spell that created the light is dispelled.</p>","unidentified":""},"source":"Basic Rules, Player's Handbook pg 230","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"evo","components":{"value":"bat fur and a drop of pitch or piece of coal","vocal":true,"somatic":false,"material":true,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"effects":[{"_id":"6URqXYM8cSWbMZ53","flags":{"dae":{"stackable":false,"specialDuration":[],"transfer":false}},"changes":[{"key":"macro.itemMacro","value":"","mode":0,"priority":20}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/evil-eye-red-2.jpg","label":"Darkness","tint":null,"transfer":false}],"folder":null,"sort":0,"permission":{"default":0,"FEWmZGWq8JJmEjb4":3},"flags":{"ddbimporter":{"id":136494,"definitionId":2058,"entityTypeId":435869154,"dndbeyond":{"lookup":"generic","lookupName":"generic","level":null,"castAtLevel":null},"sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":230,"sourceType":1}],"tags":["Control"]},"betterRolls5e":{"quickVersatile":{"altValue":true},"quickCharges":{"value":{"use":true,"resource":true},"altValue":{"use":true,"resource":true}}},"dae":{"activeEquipped":false,"alwaysActive":false},"midi-qol":{"onUseMacroName":"ItemMacro"},"itemacro":{"macro":{"_data":{"name":"Darkness","type":"script","scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target \nconst lastArg = args[args.length - 1];\nlet tactor;\nif (lastArg.tokenId) tactor = canvas.tokens.get(lastArg.tokenId).actor;\nelse tactor = game.actors.get(lastArg.actorId);\nconst target = canvas.tokens.get(lastArg.tokenId) || token;\n\n\nif (args[0] === \"on\") {\n\n    let templateData = {\n        t: \"circle\",\n        user: game.user._id,\n        distance: 15,\n        direction: 0,\n        x: 0,\n        y: 0,\n        fillColor: game.user.color,\n        flags: {\n            DAESRD: {\n                Darkness: {\n                    ActorId: tactor.id\n                }\n            }\n        }\n    };\n\n    Hooks.once(\"createMeasuredTemplate\", async (scene, template) => {\n        let radius = canvas.grid.size * (template.distance / canvas.grid.grid.options.dimensions.distance)\n        circleWall(template.x, template.y, radius)\n        await canvas.templates.deleteMany(template._id);\n    });\n\n    let template = new game.dnd5e.canvas.AbilityTemplate(templateData);\n    template.actorSheet = tactor.sheet;\n    template.drawPreview();\n\n    async function circleWall(cx, cy, radius) {\n        const step = 30;\n        for (let i = step; i <= 360; i += step) {\n            let theta0 = toRadians(i - step);\n            let theta1 = toRadians(i);\n\n            let lastX = Math.floor(radius * Math.cos(theta0) + cx);\n            let lastY = Math.floor(radius * Math.sin(theta0) + cy);\n            let newX = Math.floor(radius * Math.cos(theta1) + cx);\n            let newY = Math.floor(radius * Math.sin(theta1) + cy);\n\n            await Wall.create({\n                c: [lastX, lastY, newX, newY],\n                move: CONST.WALL_MOVEMENT_TYPES.NONE,\n                sense: CONST.WALL_SENSE_TYPES.NORMAL,\n                dir: CONST.WALL_DIRECTIONS.BOTH,\n                door: CONST.WALL_DOOR_TYPES.NONE,\n                ds: CONST.WALL_DOOR_STATES.CLOSED,\n                flags: {\n                    DAESRD: {\n                        Darkness: {\n                            ActorId: tactor.id\n                        }\n                    }\n                }\n            });\n        }\n\n    }\n\n}\n\nif (args[0] === \"off\") {\n    async function removeWalls() {\n        let darkWalls = canvas.walls.placeables.filter(w => w.data.flags?.DAESRD?.Darkness?.ActorId === tactor.id)\n        let wallArray = darkWalls.map(function (w) {\n            return w.data._id\n        })\n        await canvas.walls.deleteMany(wallArray)\n    }\n    removeWalls()\n}","author":"E4BVikjIkVl2lL2j"},"data":{"name":"Darkness","type":"script","scope":"global","command":"/*ASE_REPLACED*/if(args[0] === \"off\"){\n                            //console.log(\"token: \", token)\n                            let darknessTiles = Tagger.getByTag(`DarknessTile-${args[1].tokenId}`);\n                            darknessTiles.then(async (tiles) => {\n                                //console.log(\"tiles to delete: \", [tiles[0].id]);\n                                if(tiles.length>0){\n                                game.AdvancedSpellEffects.removeTiles([tiles[0].id]);\n                            }\n                            })\n                        }\n                    else\n                    {\n                        let options = {version: \"MIDI\", args: args};\n                        game.AdvancedSpellEffects.darkness(options);\n                    }","author":"zrPR3wueYsESSBR3","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"permission":{"default":0},"flags":{}},"options":{},"apps":{},"compendium":null}},"cf":{"id":"temp_xbat54h1eir"},"core":{"sourceId":"Compendium.world.ddb-candlekeep-adventures-spells.uM9efP1aHFRuIGed"},"enhancedcombathud":{"set1p":false,"set2p":false,"set3p":false},"targetreacts":{"shakeDelay":""},"advancedspelleffects":{"enableASE":true}},"_id":"GpXSCWSnqW4MarvA"}
{"name":"Spiritual Weapon","type":"spell","img":"systems/dnd5e/icons/spells/enchant-magenta-2.jpg","data":{"description":{"value":"<p>You create a floating, spectral weapon within range that lasts for the duration or until you cast this spell again. When you cast the spell, you can make a melee spell attack against a creature within 5 feet of the weapon. On a hit, the target takes force damage equal to 1d8 + your spellcasting ability modifier.</p>\n<p>As a bonus action on your turn, you can move the weapon up to 20 feet and repeat the attack against a creature within 5 feet of it.</p>\n<p>The weapon can take whatever form you choose. Clerics of deities who are associated with a particular weapon (as St. Cuthbert is known for his mace and Thor for his hammer) make this spell's effect resemble that weapon.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for every two slot levels above 2nd.</p>","chat":"<p>You create a floating, spectral weapon within range that lasts for the duration or until you cast this spell again. When you cast the spell, you can make a melee spell attack against a creature within 5 feet of the weapon. On a hit, the target takes force damage equal to 1d8 + your spellcasting ability modifier.</p>\n<p>As a bonus action on your turn, you can move the weapon up to 20 feet and repeat the attack against a creature within 5 feet of it.</p>\n<p>The weapon can take whatever form you choose. Clerics of deities who are associated with a particular weapon (as St. Cuthbert is known for his mace and Thor for his hammer) make this spell's effect resemble that weapon.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for every two slot levels above 2nd.</p>","unidentified":""},"source":"Basic Rules, Player's Handbook pg 278","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":""},"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"effects":[{"_id":"atMn9UEVkYDOK1KK","flags":{"dae":{"stackable":false,"specialDuration":["None"],"macroRepeat":"none","transfer":false},"ActiveAuras":{"isAura":false,"ignoreSelf":false,"hidden":false,"height":false,"aura":"None","radius":null,"alignment":"","type":"","save":"","savedc":null,"hostile":false,"onlyOnce":false,"time":"None"}},"changes":[{"key":"macro.itemMacro","value":"@item.level @attributes.spellcasting","mode":0,"priority":20}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/enchant-magenta-2.jpg","label":"Spiritual Weapon","tint":null,"transfer":false}],"folder":null,"sort":0,"permission":{"default":0,"FEWmZGWq8JJmEjb4":3},"flags":{"ddbimporter":{"id":138787,"definitionId":2263,"entityTypeId":435869154,"dndbeyond":{"lookup":"generic","lookupName":"generic","level":null,"castAtLevel":null},"sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":278,"sourceType":1}],"tags":["Damage"]},"betterRolls5e":{"quickVersatile":{"altValue":true},"quickCharges":{"value":{"use":true,"resource":true},"altValue":{"use":true,"resource":true}}},"dae":{"activeEquipped":false,"alwaysActive":false},"midi-qol":{"onUseMacroName":"ItemMacro","criticalThreshold":"20"},"itemacro":{"macro":{"_data":{"name":"Spiritual Weapon","type":"script","scope":"global","command":"//DAE Item Macro Execute, value = @item.level\n// Set spell to self cast, no damage/attack roll\nconst lastArg = args[args.length - 1];\nlet tactor;\nif (lastArg.tokenId) tactor = canvas.tokens.get(lastArg.tokenId).actor;\nelse tactor = game.actors.get(lastArg.actorId);\nconst target = canvas.tokens.get(lastArg.tokenId) || token;\n\nconst castingItem = lastArg.efData.flags.dae.itemData\nlet data = {}\n\n/**\n * Create Spiritual Weapon item in inventory\n */\nif (args[0] === \"on\") {\n  let damage = Math.floor(Math.floor(args[1] / 2));\n  let image = castingItem.img;\n\n  let range = MeasuredTemplate.create({\n    t: \"circle\",\n    user: game.user._id,\n    x: target.x + canvas.grid.size / 2,\n    y: target.y + canvas.grid.size / 2,\n    direction: 0,\n    distance: 60,\n    borderColor: \"#FF0000\",\n    flags: {\n      DAESRD: {\n        SpiritualWeaponRange: {\n          ActorId: tactor.id\n        }\n      }\n    }\n    //fillColor: \"#FF3366\",\n  });\n  range.then(result => {\n    let templateData = {\n      t: \"rect\",\n      user: game.user._id,\n      distance: 7,\n      direction: 45,\n      x: 0,\n      y: 0,\n      flags: {\n        DAESRD: {\n          SpiritualWeapon: {\n            ActorId: tactor.id\n          }\n        }\n      },\n      fillColor: game.user.color\n    }\n    Hooks.once(\"createMeasuredTemplate\", deleteTemplates);\n\n    let template = new game.dnd5e.canvas.AbilityTemplate(templateData)\n    template.actorSheet = tactor.sheet;\n    template.drawPreview()\n\n    async function deleteTemplates(scene, template) {\n      let removeTemplates = canvas.templates.placeables.filter(i => i.data.flags.DAESRD?.SpiritualWeaponRange?.ActorId === tactor.id);\n      await canvas.templates.deleteMany([removeTemplates[0].id]);\n    };\n  })\n  await tactor.createOwnedItem(\n    {\n      \"name\": \"Summoned Spiritual Weapon\",\n      \"type\": \"weapon\",\n      \"data\": {\n        \"equipped\": true,\n        \"identified\": true,\n        \"activation\": {\n          \"type\": \"bonus\",\n        },\n        \"target\": {\n          \"value\": 1,\n          \"width\": null,\n          \"type\": \"creature\"\n        },\n        \"range\": {\n          \"value\": 5,\n          \"units\": \"ft\"\n        },\n        \"ability\": args[2],\n        \"actionType\": \"msak\",\n        \"attackBonus\": \"0\",\n        \"chatFlavor\": \"\",\n        \"critical\": null,\n        \"damage\": {\n          \"parts\": [\n            [\n              `${damage}d8+@mod`,\n              \"force\"\n            ]\n          ],\n        },\n        \"weaponType\": \"simpleM\",\n        \"proficient\": true\n      },\n      \"flags\": {\n        \"DAESRD\": {\n          \"SpiritualWeapon\":\n            target.actor.id\n        }\n      },\n      \"img\": `${image}`,\n    },\n  );\n  ui.notifications.notify(\"Weapon created in your inventory\")\n\n}\n\n// Delete Spitirual Weapon and template\nif (args[0] === \"off\") {\n  let removeItem = tactor.items.find(i => i.data.flags?.DAESRD?.SpiritualWeapon === tactor.id)\n  let template = canvas.templates.placeables.filter(i => i.data.flags.DAESRD.SpiritualWeapon?.ActorId === tactor.id)\n  if(removeItem) await tactor.deleteOwnedItem(removeItem.id);\n  if(template) await canvas.templates.deleteMany(template[0].id)\n}","author":"E4BVikjIkVl2lL2j"},"data":{"name":"Spiritual Weapon","type":"script","scope":"global","command":"/*ASE_REPLACED*/let options = {version: \"MIDI\", args: args, type: \"Spiritual Weapon\"};\ngame.AdvancedSpellEffects.summon(options);","author":"zrPR3wueYsESSBR3","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"permission":{"default":0},"flags":{}},"options":{},"apps":{},"compendium":null}},"cf":{"id":"temp_xbat54h1eir"},"core":{"sourceId":"Compendium.world.ddb-candlekeep-adventures-spells.kXZRjh0oLMFA1LVR"},"enhancedcombathud":{"set1s":false,"set2s":false,"set3s":false,"set1p":false,"set2p":false,"set3p":false},"targetreacts":{"shakeDelay":""},"advancedspelleffects":{"enableASE":true}},"_id":"IjbS99UrKgMvLm2d"}
{"name":"Call Lightning","type":"spell","img":"systems/dnd5e/icons/spells/lighting-sky-2.jpg","data":{"description":{"value":"<p>A storm cloud appears in the shape of a cylinder that is 10 feet tall with a 60-foot radius, centered on a point you can see within range directly above you. The spell fails if you can’t see a point in the air where the storm cloud could appear (for example, if you are in a room that can’t accommodate the cloud).</p>\n<p>When you cast the spell, choose a point you can see under the cloud. A bolt of lightning flashes down from the cloud to that point. Each creature within 5 feet of that point must make a Dexterity saving throw. A creature takes 3d10 lightning damage on a failed save, or half as much damage on a successful one. On each of your turns until the spell ends, you can use your action to call down lightning in this way again, targeting the same point or a different one.</p>\n<p>If you are outdoors in stormy conditions when you cast this spell, the spell gives you control over the existing storm instead of creating a new one. Under such conditions, the spell’s damage increases by 1d10.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 4th or higher level, the damage increases by 1d10 for each slot level above 3rd.</p>","chat":"<p>A storm cloud appears in the shape of a cylinder that is 10 feet tall with a 60-foot radius, centered on a point you can see within range directly above you. The spell fails if you can’t see a point in the air where the storm cloud could appear (for example, if you are in a room that can’t accommodate the cloud).</p>\n<p>When you cast the spell, choose a point you can see under the cloud. A bolt of lightning flashes down from the cloud to that point. Each creature within 5 feet of that point must make a Dexterity saving throw. A creature takes 3d10 lightning damage on a failed save, or half as much damage on a successful one. On each of your turns until the spell ends, you can use your action to call down lightning in this way again, targeting the same point or a different one.</p>\n<p>If you are outdoors in stormy conditions when you cast this spell, the spell gives you control over the existing storm instead of creating a new one. Under such conditions, the spell’s damage increases by 1d10.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 4th or higher level, the damage increases by 1d10 for each slot level above 3rd.</p>","unidentified":""},"source":"Basic Rules, Player's Handbook pg 220","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":3,"school":"con","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"effects":[{"_id":"xfVuiySO5CUntl2N","flags":{"dae":{"stackable":false,"specialDuration":"None","transfer":false}},"changes":[{"key":"macro.itemMacro","value":"@target @item.level","mode":0,"priority":20}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/lighting-sky-2.jpg","label":"Call Lightning Summon","tint":null,"transfer":false}],"folder":null,"sort":0,"permission":{"default":0,"FEWmZGWq8JJmEjb4":3},"flags":{"ddbimporter":{"id":136172,"definitionId":2022,"entityTypeId":435869154,"dndbeyond":{"lookup":"generic","lookupName":"generic","level":null,"castAtLevel":null},"sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":220,"sourceType":1}],"tags":["Damage"]},"betterRolls5e":{"quickVersatile":{"altValue":true},"quickCharges":{"value":{"use":true,"resource":true},"altValue":{"use":true,"resource":true}}},"dae":{"activeEquipped":false,"alwaysActive":false},"midi-qol":{"onUseMacroName":"ItemMacro"},"itemacro":{"macro":{"_data":{"name":"Call Lightning","type":"script","scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" \nconst lastArg = args[args.length - 1];\nlet tactor;\nif (lastArg.tokenId) tactor = canvas.tokens.get(lastArg.tokenId).actor;\nelse tactor = game.actors.get(lastArg.actorId);\n\nconst DAEitem = lastArg.efData.flags.dae.itemData\nconst saveData = DAEitem.data.save\n/**\n * Create Call Lightning Bolt item in inventory\n */\nif (args[0] === \"on\") {\n    let templateData = {\n        t: \"circle\",\n        user: game.user._id,\n        distance: 60,\n        direction: 0,\n        x: 0,\n        y: 0,\n        flags: {\n            DAESRD: {\n                CallLighting: {\n                    ActorId: tactor.id\n                }\n            }\n        },\n        fillColor: game.user.color\n    }\n    let template = new game.dnd5e.canvas.AbilityTemplate(templateData)\n    template.actorSheet = tactor.sheet;\n    template.drawPreview()\n    await tactor.createOwnedItem(\n        {\n            \"name\": \"Call Lightning - bolt\",\n            \"type\": \"spell\",\n            \"data\": {\n              \"description\": {\n                \"value\": \"<p><span style=\\\"color: #191813; font-size: 13px;\\\">A bolt of lightning flashes down from the cloud to that point. Each creature within 5 feet of that point must make a Dexterity saving throw. A creature takes 3d10 lightning damage on a failed save, or half as much damage on a successful one.</span></p>\"\n              },\n              \"activation\": {\n                \"type\": \"action\"\n              },\n              \"target\": {\n                \"value\": 5,\n                \"width\": null,\n                \"units\": \"ft\",\n                \"type\": \"radius\"\n              },\n              \"ability\": \"\",\n              \"actionType\": \"save\",\n              \"damage\": {\n                \"parts\": [\n                  [\n                    `${DAEitem.data.level}d10`,\n                    \"lightning\"\n                  ]\n                ],\n                \"versatile\": \"\"\n              },\n              \"formula\": \"\",\n              \"save\": {\n                \"ability\": \"dex\",\n                \"dc\": 16,\n                \"scaling\": \"spell\"\n              },\n              \"level\": 0,\n              \"school\": \"abj\",\n              \"preparation\": {\n                \"mode\": \"prepared\",\n                \"prepared\": false\n              },\n              \"scaling\": {\n                \"mode\": \"none\",\n                \"formula\": \"\"\n              }\n            },\n            \"img\": \"systems/dnd5e/icons/spells/lighting-sky-2.jpg\"\n          }\n    );\n}\n\n// Delete Flame Blade\nif (args[0] === \"off\") {\n    let castItem = tactor.data.items.find(i => i.name === \"Call Lightning - bolt\" && i.type === \"spell\")\n    if(castItem) await tactor.deleteOwnedItem(castItem._id)\n    let template = canvas.templates.placeables.filter(i => i.data.flags.DAESRD?.CallLighting?.ActorId === tactor.id)\n    if(template) await canvas.templates.deleteMany(template[0].id)\n\n}","author":"E4BVikjIkVl2lL2j"},"data":{"name":"Call Lightning","type":"script","scope":"global","command":"/*ASE_REPLACED*/\nif(args[0] === \"off\"){\n    //console.log(\"token: \", token)\n    let stormCloudTiles = canvas.scene.tiles.filter((tile) => tile.data.flags.advancedspelleffects?.stormCloudTile == args[1].tokenId);\n        //console.log(\"tiles to delete: \", [tiles[0].id]);\n        if(stormCloudTiles.length>0){\n            game.AdvancedSpellEffects.removeTiles([stormCloudTiles[0].id]);\n        }\n}\nelse\n{\n    let options = {version: \"MIDI\", args: args, boltStyle: \"chain\"};\ngame.AdvancedSpellEffects.callLightning(options);\n}","author":"zrPR3wueYsESSBR3","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"permission":{"default":0},"flags":{}},"options":{},"apps":{},"compendium":null}},"cf":{"id":"temp_dpq2n6d2998"},"core":{"sourceId":"Compendium.world.ddb-candlekeep-adventures-spells.LbJrsGxIZxU67Ett"},"enhancedcombathud":{"set1p":false,"set2p":false,"set3p":false},"targetreacts":{"shakeDelay":""},"advancedspelleffects":{"enableASE":true}},"_id":"JS1muV1HIlIAKMRV"}
{"name":"Fog Cloud","type":"spell","img":"systems/dnd5e/icons/spells/fog-water-air-2.jpg","data":{"description":{"value":"<p>You create a 20-foot-radius sphere of fog centered on a point within range. The sphere spreads around corners, and its area is heavily obscured. It lasts for the duration or until a wind of moderate or greater speed (at least 10 miles per hour) disperses it.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the radius of the fog increases by 20 feet for each slot level above 1st.</p>","chat":"<p>You create a 20-foot-radius sphere of fog centered on a point within range. The sphere spreads around corners, and its area is heavily obscured. It lasts for the duration or until a wind of moderate or greater speed (at least 10 miles per hour) disperses it.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the radius of the fog increases by 20 feet for each slot level above 1st.</p>","unidentified":""},"source":"Basic Rules, Player's Handbook pg 243","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"con","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"FEWmZGWq8JJmEjb4":3},"flags":{"ddbimporter":{"id":137872,"definitionId":2112,"entityTypeId":435869154,"dndbeyond":{"lookup":"generic","lookupName":"generic","level":null,"castAtLevel":null},"sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":243,"sourceType":1}],"tags":["Control","Environment"]},"betterRolls5e":{"quickVersatile":{"altValue":true},"quickCharges":{"value":{"use":true,"resource":true},"altValue":{"use":true,"resource":true}}},"cf":{"id":"temp_b2nw42skn5p"},"core":{"sourceId":"Compendium.world.ddb-candlekeep-adventures-spells.kQGtBX2QOH5dvR7w"},"enhancedcombathud":{"set1p":false,"set2p":false,"set3p":false},"targetreacts":{"shakeDelay":""},"midi-qol":{"onUseMacroName":"ItemMacro"},"advancedspelleffects":{"enableASE":true,"effectOptions":{"wallNumber":12}},"itemacro":{"macro":{"data":{"command":"/*ASE_REPLACED*/\nif(args[0] === \"off\"){\n    console.log(\"token: \", token)\n    let fogCloudTiles = Tagger.getByTag(`FogCloudTile-${args[1].tokenId}`);\n        fogCloudTiles.then(async (tiles) => {\n            console.log(\"tiles to delete: \", tiles);\n            if(tiles.length>0){\n            game.AdvancedSpellEffects.removeTiles([tiles[0].id]);\n            }\n        })\n        }\n    else if(args[0] != \"on\" && args[0] != \"off\"){\n        let options = {version: \"MIDI\", args: args, numberWalls: 12};\n        game.AdvancedSpellEffects.fogCloud(options);\n    }","name":"Fog Cloud"}}}},"_id":"pZfxPjnfMDc5SBLy"}
{"$$deleted":true,"_id":"JS1muV1HIlIAKMRV"}
{"$$deleted":true,"_id":"GpXSCWSnqW4MarvA"}
{"$$deleted":true,"_id":"4DrhBocpi87SUKQI"}
{"$$deleted":true,"_id":"pZfxPjnfMDc5SBLy"}
{"$$deleted":true,"_id":"IjbS99UrKgMvLm2d"}
{"name":"Detect Magic","type":"spell","img":"systems/dnd5e/icons/spells/light-blue-2.jpg","data":{"description":{"value":"<p>For the duration, you sense the presence of magic within 30 feet of you. If you sense magic in this way, you can use your action to see a faint aura around any visible creature or object in the area that bears magic, and you learn its school of magic, if any.</p>\n<p>The spell can penetrate most barriers, but it is blocked by 1 foot of stone, 1 inch of common metal, a thin sheet of lead, or 3 feet of wood or dirt.</p>","chat":"<p>For the duration, you sense the presence of magic within 30 feet of you. If you sense magic in this way, you can use your action to see a faint aura around any visible creature or object in the area that bears magic, and you learn its school of magic, if any.</p>\n<p>The spell can penetrate most barriers, but it is blocked by 1 foot of stone, 1 inch of common metal, a thin sheet of lead, or 3 feet of wood or dirt.</p>","unidentified":""},"source":"Basic Rules, Player's Handbook pg 231","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"div","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":true,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"FEWmZGWq8JJmEjb4":3},"flags":{"ddbimporter":{"id":136561,"definitionId":2065,"entityTypeId":435869154,"dndbeyond":{"lookup":"generic","lookupName":"generic","level":null,"castAtLevel":null},"sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":231,"sourceType":1}],"tags":["Detection"]},"betterRolls5e":{"quickVersatile":{"altValue":true},"quickCharges":{"value":{"use":true,"resource":true},"altValue":{"use":true,"resource":true}}},"cf":{"id":"temp_b2nw42skn5p","path":"1st Level","color":"#000000"},"core":{"sourceId":"Compendium.world.ddb-candlekeep-adventures-spells.FavliCsUSB9IGttT"},"advancedspelleffects":{"enableASE":true,"effectOptions":{"waveColor":"blue","auraColor":"blue"}},"enhancedcombathud":{"set1p":false,"set2p":false,"set3p":false},"targetreacts":{"shakeDelay":""},"midi-qol":{"onUseMacroName":""}},"_id":"eK6vWbZu9YCDoaoa"}
{"name":"Fog Cloud","type":"spell","img":"systems/dnd5e/icons/spells/fog-water-air-2.jpg","data":{"description":{"value":"<p>You create a 20-foot-radius sphere of fog centered on a point within range. The sphere spreads around corners, and its area is heavily obscured. It lasts for the duration or until a wind of moderate or greater speed (at least 10 miles per hour) disperses it.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the radius of the fog increases by 20 feet for each slot level above 1st.</p>","chat":"<p>You create a 20-foot-radius sphere of fog centered on a point within range. The sphere spreads around corners, and its area is heavily obscured. It lasts for the duration or until a wind of moderate or greater speed (at least 10 miles per hour) disperses it.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 2nd level or higher, the radius of the fog increases by 20 feet for each slot level above 1st.</p>","unidentified":""},"source":"Basic Rules, Player's Handbook pg 243","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":1,"school":"con","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"effects":[],"folder":null,"sort":0,"permission":{"default":0,"FEWmZGWq8JJmEjb4":3},"flags":{"ddbimporter":{"id":137872,"definitionId":2112,"entityTypeId":435869154,"dndbeyond":{"lookup":"generic","lookupName":"generic","level":null,"castAtLevel":null},"sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":243,"sourceType":1}],"tags":["Control","Environment"]},"betterRolls5e":{"quickVersatile":{"altValue":true},"quickCharges":{"value":{"use":true,"resource":true},"altValue":{"use":true,"resource":true}}},"cf":{"id":"temp_b2nw42skn5p"},"core":{"sourceId":"Compendium.world.ddb-candlekeep-adventures-spells.kQGtBX2QOH5dvR7w"},"advancedspelleffects":{"enableASE":true,"effectOptions":{"wallNumber":12}},"enhancedcombathud":{"set1p":false,"set2p":false,"set3p":false},"targetreacts":{"shakeDelay":""},"midi-qol":{"onUseMacroName":""}},"_id":"BwVHOP2TICD0wQIL"}
{"name":"Darkness","type":"spell","img":"systems/dnd5e/icons/spells/evil-eye-red-2.jpg","data":{"description":{"value":"<p>Magical darkness spreads from a point you choose within range to fill a 15-foot-radius sphere for the duration. The darkness spreads around corners. A creature with darkvision can't see through this darkness, and nonmagical light can't illuminate it.</p>\n<p>If the point you choose is on an object you are holding or one that isn't being worn or carried, the darkness emanates from the object and moves with it. Completely covering the source of the darkness with an opaque object, such as a bowl or a helm, blocks the darkness.</p>\n<p>If any of this spell's area overlaps with an area of light created by a spell of 2nd level or lower, the spell that created the light is dispelled.</p>","chat":"<p>Magical darkness spreads from a point you choose within range to fill a 15-foot-radius sphere for the duration. The darkness spreads around corners. A creature with darkvision can't see through this darkness, and nonmagical light can't illuminate it.</p>\n<p>If the point you choose is on an object you are holding or one that isn't being worn or carried, the darkness emanates from the object and moves with it. Completely covering the source of the darkness with an opaque object, such as a bowl or a helm, blocks the darkness.</p>\n<p>If any of this spell's area overlaps with an area of light created by a spell of 2nd level or lower, the spell that created the light is dispelled.</p>","unidentified":""},"source":"Basic Rules, Player's Handbook pg 230","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"evo","components":{"value":"bat fur and a drop of pitch or piece of coal","vocal":true,"somatic":false,"material":true,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"effects":[{"_id":"6URqXYM8cSWbMZ53","flags":{"dae":{"stackable":false,"specialDuration":[],"transfer":false}},"changes":[{"key":"macro.itemMacro","value":"","mode":0,"priority":20}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/evil-eye-red-2.jpg","label":"Darkness","tint":null,"transfer":false}],"folder":null,"sort":0,"permission":{"default":0,"FEWmZGWq8JJmEjb4":3},"flags":{"ddbimporter":{"id":136494,"definitionId":2058,"entityTypeId":435869154,"dndbeyond":{"lookup":"generic","lookupName":"generic","level":null,"castAtLevel":null},"sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":230,"sourceType":1}],"tags":["Control"]},"betterRolls5e":{"quickVersatile":{"altValue":true},"quickCharges":{"value":{"use":true,"resource":true},"altValue":{"use":true,"resource":true}}},"dae":{"activeEquipped":false,"alwaysActive":false},"midi-qol":{"onUseMacroName":""},"itemacro":{"macro":{"_data":{"name":"Darkness","type":"script","scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" @target \nconst lastArg = args[args.length - 1];\nlet tactor;\nif (lastArg.tokenId) tactor = canvas.tokens.get(lastArg.tokenId).actor;\nelse tactor = game.actors.get(lastArg.actorId);\nconst target = canvas.tokens.get(lastArg.tokenId) || token;\n\n\nif (args[0] === \"on\") {\n\n    let templateData = {\n        t: \"circle\",\n        user: game.user._id,\n        distance: 15,\n        direction: 0,\n        x: 0,\n        y: 0,\n        fillColor: game.user.color,\n        flags: {\n            DAESRD: {\n                Darkness: {\n                    ActorId: tactor.id\n                }\n            }\n        }\n    };\n\n    Hooks.once(\"createMeasuredTemplate\", async (scene, template) => {\n        let radius = canvas.grid.size * (template.distance / canvas.grid.grid.options.dimensions.distance)\n        circleWall(template.x, template.y, radius)\n        await canvas.templates.deleteMany(template._id);\n    });\n\n    let template = new game.dnd5e.canvas.AbilityTemplate(templateData);\n    template.actorSheet = tactor.sheet;\n    template.drawPreview();\n\n    async function circleWall(cx, cy, radius) {\n        const step = 30;\n        for (let i = step; i <= 360; i += step) {\n            let theta0 = toRadians(i - step);\n            let theta1 = toRadians(i);\n\n            let lastX = Math.floor(radius * Math.cos(theta0) + cx);\n            let lastY = Math.floor(radius * Math.sin(theta0) + cy);\n            let newX = Math.floor(radius * Math.cos(theta1) + cx);\n            let newY = Math.floor(radius * Math.sin(theta1) + cy);\n\n            await Wall.create({\n                c: [lastX, lastY, newX, newY],\n                move: CONST.WALL_MOVEMENT_TYPES.NONE,\n                sense: CONST.WALL_SENSE_TYPES.NORMAL,\n                dir: CONST.WALL_DIRECTIONS.BOTH,\n                door: CONST.WALL_DOOR_TYPES.NONE,\n                ds: CONST.WALL_DOOR_STATES.CLOSED,\n                flags: {\n                    DAESRD: {\n                        Darkness: {\n                            ActorId: tactor.id\n                        }\n                    }\n                }\n            });\n        }\n\n    }\n\n}\n\nif (args[0] === \"off\") {\n    async function removeWalls() {\n        let darkWalls = canvas.walls.placeables.filter(w => w.data.flags?.DAESRD?.Darkness?.ActorId === tactor.id)\n        let wallArray = darkWalls.map(function (w) {\n            return w.data._id\n        })\n        await canvas.walls.deleteMany(wallArray)\n    }\n    removeWalls()\n}","author":"E4BVikjIkVl2lL2j"},"data":{"name":"Darkness","type":"script","scope":"global","command":"if (!game.modules.get(\"advanced-macros\")?.active) ui.notifications.error(\"Please enable the Advanced Macros module\")\n\n//DAE macro, Effect arguments = @target \nconst lastArg = args[args.length - 1];\nlet tactor;\nif (lastArg.tokenId) tactor = canvas.tokens.get(lastArg.tokenId).actor;\nelse tactor = game.actors.get(lastArg.actorId);\nconst target = canvas.tokens.get(lastArg.tokenId) || token;\n\n\nif (args[0] === \"on\") {\n\n    let templateData = {\n        t: \"circle\",\n        user: game.user._id,\n        distance: 15,\n        direction: 0,\n        x: 0,\n        y: 0,\n        fillColor: game.user.color,\n        flags: {\n            DAESRD: {\n                Darkness: {\n                    ActorId: tactor.id\n                }\n            }\n        }\n    };\n\n    Hooks.once(\"createMeasuredTemplate\", async (template) => {\n        let radius = canvas.grid.size * (template.data.distance / canvas.grid.grid.options.dimensions.distance)\n        circleWall(template.data.x, template.data.y, radius)\n        await canvas.templates.deleteMany(template._id);\n    });\n\n    let doc = new CONFIG.MeasuredTemplate.documentClass(templateData, { parent: canvas.scene })\n    let template = new game.dnd5e.canvas.AbilityTemplate(doc);\n    template.actorSheet = tactor.sheet;\n    template.drawPreview();\n\n    async function circleWall(cx, cy, radius) {\n        let data = [];\n        const step = 30;\n        for (let i = step; i <= 360; i += step) {\n            let theta0 = Math.toRadians(i - step);\n            let theta1 = Math.toRadians(i);\n\n            let lastX = Math.floor(radius * Math.cos(theta0) + cx);\n            let lastY = Math.floor(radius * Math.sin(theta0) + cy);\n            let newX = Math.floor(radius * Math.cos(theta1) + cx);\n            let newY = Math.floor(radius * Math.sin(theta1) + cy);\n\n            data.push({\n                c: [lastX, lastY, newX, newY],\n                move: CONST.WALL_MOVEMENT_TYPES.NONE,\n                sense: CONST.WALL_SENSE_TYPES.NORMAL,\n                dir: CONST.WALL_DIRECTIONS.BOTH,\n                door: CONST.WALL_DOOR_TYPES.NONE,\n                ds: CONST.WALL_DOOR_STATES.CLOSED,\n                flags: {\n                    DAESRD: {\n                        Darkness: {\n                            ActorId: tactor.id\n                        }\n                    }\n                }\n            });\n        }\n        canvas.scene.createEmbeddedDocuments(\"Wall\", data)\n    }\n\n}\n\nif (args[0] === \"off\") {\n    async function removeWalls() {\n        let darkWalls = canvas.walls.placeables.filter(w => w.data.flags?.DAESRD?.Darkness?.ActorId === tactor.id)\n        let wallArray = darkWalls.map(function (w) {\n            return w.data._id\n        })\n        await canvas.walls.deleteEmbeddedDocuments(wallArray)\n    }\n    removeWalls()\n}","author":"zrPR3wueYsESSBR3","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"permission":{"default":0},"flags":{}},"options":{},"apps":{},"compendium":null}},"cf":{"id":"temp_xbat54h1eir"},"core":{"sourceId":"Compendium.world.ddb-candlekeep-adventures-spells.uM9efP1aHFRuIGed"},"advancedspelleffects":{"enableASE":true},"enhancedcombathud":{"set1p":false,"set2p":false,"set3p":false},"targetreacts":{"shakeDelay":""}},"_id":"pTmfIX9ui2xqSTG0"}
{"name":"Spiritual Weapon","type":"spell","img":"systems/dnd5e/icons/spells/enchant-magenta-2.jpg","data":{"description":{"value":"<p>You create a floating, spectral weapon within range that lasts for the duration or until you cast this spell again. When you cast the spell, you can make a melee spell attack against a creature within 5 feet of the weapon. On a hit, the target takes force damage equal to 1d8 + your spellcasting ability modifier.</p>\n<p>As a bonus action on your turn, you can move the weapon up to 20 feet and repeat the attack against a creature within 5 feet of it.</p>\n<p>The weapon can take whatever form you choose. Clerics of deities who are associated with a particular weapon (as St. Cuthbert is known for his mace and Thor for his hammer) make this spell's effect resemble that weapon.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for every two slot levels above 2nd.</p>","chat":"<p>You create a floating, spectral weapon within range that lasts for the duration or until you cast this spell again. When you cast the spell, you can make a melee spell attack against a creature within 5 feet of the weapon. On a hit, the target takes force damage equal to 1d8 + your spellcasting ability modifier.</p>\n<p>As a bonus action on your turn, you can move the weapon up to 20 feet and repeat the attack against a creature within 5 feet of it.</p>\n<p>The weapon can take whatever form you choose. Clerics of deities who are associated with a particular weapon (as St. Cuthbert is known for his mace and Thor for his hammer) make this spell's effect resemble that weapon.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for every two slot levels above 2nd.</p>","unidentified":""},"source":"Basic Rules, Player's Handbook pg 278","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":null,"units":""},"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":2,"school":"evo","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":false},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"effects":[{"_id":"atMn9UEVkYDOK1KK","flags":{"dae":{"stackable":false,"specialDuration":["None"],"macroRepeat":"none","transfer":false},"ActiveAuras":{"isAura":false,"ignoreSelf":false,"hidden":false,"height":false,"aura":"None","radius":null,"alignment":"","type":"","save":"","savedc":null,"hostile":false,"onlyOnce":false,"time":"None"}},"changes":[{"key":"macro.itemMacro","value":"@item.level @attributes.spellcasting","mode":0,"priority":20}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/enchant-magenta-2.jpg","label":"Spiritual Weapon","tint":null,"transfer":false}],"folder":null,"sort":0,"permission":{"default":0,"FEWmZGWq8JJmEjb4":3},"flags":{"ddbimporter":{"id":138787,"definitionId":2263,"entityTypeId":435869154,"dndbeyond":{"lookup":"generic","lookupName":"generic","level":null,"castAtLevel":null},"sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":278,"sourceType":1}],"tags":["Damage"]},"betterRolls5e":{"quickVersatile":{"altValue":true},"quickCharges":{"value":{"use":true,"resource":true},"altValue":{"use":true,"resource":true}}},"dae":{"activeEquipped":false,"alwaysActive":false},"midi-qol":{"onUseMacroName":""},"itemacro":{"macro":{"_data":{"name":"Spiritual Weapon","type":"script","scope":"global","command":"//DAE Item Macro Execute, value = @item.level\n// Set spell to self cast, no damage/attack roll\nconst lastArg = args[args.length - 1];\nlet tactor;\nif (lastArg.tokenId) tactor = canvas.tokens.get(lastArg.tokenId).actor;\nelse tactor = game.actors.get(lastArg.actorId);\nconst target = canvas.tokens.get(lastArg.tokenId) || token;\n\nconst castingItem = lastArg.efData.flags.dae.itemData\nlet data = {}\n\n/**\n * Create Spiritual Weapon item in inventory\n */\nif (args[0] === \"on\") {\n  let damage = Math.floor(Math.floor(args[1] / 2));\n  let image = castingItem.img;\n\n  let range = MeasuredTemplate.create({\n    t: \"circle\",\n    user: game.user._id,\n    x: target.x + canvas.grid.size / 2,\n    y: target.y + canvas.grid.size / 2,\n    direction: 0,\n    distance: 60,\n    borderColor: \"#FF0000\",\n    flags: {\n      DAESRD: {\n        SpiritualWeaponRange: {\n          ActorId: tactor.id\n        }\n      }\n    }\n    //fillColor: \"#FF3366\",\n  });\n  range.then(result => {\n    let templateData = {\n      t: \"rect\",\n      user: game.user._id,\n      distance: 7,\n      direction: 45,\n      x: 0,\n      y: 0,\n      flags: {\n        DAESRD: {\n          SpiritualWeapon: {\n            ActorId: tactor.id\n          }\n        }\n      },\n      fillColor: game.user.color\n    }\n    Hooks.once(\"createMeasuredTemplate\", deleteTemplates);\n\n    let template = new game.dnd5e.canvas.AbilityTemplate(templateData)\n    template.actorSheet = tactor.sheet;\n    template.drawPreview()\n\n    async function deleteTemplates(scene, template) {\n      let removeTemplates = canvas.templates.placeables.filter(i => i.data.flags.DAESRD?.SpiritualWeaponRange?.ActorId === tactor.id);\n      await canvas.templates.deleteMany([removeTemplates[0].id]);\n    };\n  })\n  await tactor.createOwnedItem(\n    {\n      \"name\": \"Summoned Spiritual Weapon\",\n      \"type\": \"weapon\",\n      \"data\": {\n        \"equipped\": true,\n        \"identified\": true,\n        \"activation\": {\n          \"type\": \"bonus\",\n        },\n        \"target\": {\n          \"value\": 1,\n          \"width\": null,\n          \"type\": \"creature\"\n        },\n        \"range\": {\n          \"value\": 5,\n          \"units\": \"ft\"\n        },\n        \"ability\": args[2],\n        \"actionType\": \"msak\",\n        \"attackBonus\": \"0\",\n        \"chatFlavor\": \"\",\n        \"critical\": null,\n        \"damage\": {\n          \"parts\": [\n            [\n              `${damage}d8+@mod`,\n              \"force\"\n            ]\n          ],\n        },\n        \"weaponType\": \"simpleM\",\n        \"proficient\": true\n      },\n      \"flags\": {\n        \"DAESRD\": {\n          \"SpiritualWeapon\":\n            target.actor.id\n        }\n      },\n      \"img\": `${image}`,\n    },\n  );\n  ui.notifications.notify(\"Weapon created in your inventory\")\n\n}\n\n// Delete Spitirual Weapon and template\nif (args[0] === \"off\") {\n  let removeItem = tactor.items.find(i => i.data.flags?.DAESRD?.SpiritualWeapon === tactor.id)\n  let template = canvas.templates.placeables.filter(i => i.data.flags.DAESRD.SpiritualWeapon?.ActorId === tactor.id)\n  if(removeItem) await tactor.deleteOwnedItem(removeItem.id);\n  if(template) await canvas.templates.deleteMany(template[0].id)\n}","author":"E4BVikjIkVl2lL2j"},"data":{"name":"Spiritual Weapon","type":"script","scope":"global","command":"//DAE Item Macro Execute, value = @item.level\n// Set spell to self cast, no damage/attack roll\nconst lastArg = args[args.length - 1];\nlet tactor;\nif (lastArg.tokenId) tactor = canvas.tokens.get(lastArg.tokenId).actor;\nelse tactor = game.actors.get(lastArg.actorId);\nconst target = canvas.tokens.get(lastArg.tokenId) || token;\n\nconst castingItem = lastArg.efData.flags.dae.itemData\nlet data = {}\n\n/**\n * Create Spiritual Weapon item in inventory\n */\nif (args[0] === \"on\") {\n  let damage = Math.floor(Math.floor(args[1] / 2));\n  let image = castingItem.img;\n\n  let range = canvas.scene.createEmbeddedDocuments(\"MeasuredTemplate\", [{\n    t: \"circle\",\n    user: game.user._id,\n    x: target.x + canvas.grid.size / 2,\n    y: target.y + canvas.grid.size / 2,\n    direction: 0,\n    distance: 60,\n    borderColor: \"#FF0000\",\n    flags: {\n      DAESRD: {\n        SpiritualWeaponRange: {\n          ActorId: tactor.id\n        }\n      }\n    }\n    //fillColor: \"#FF3366\",\n  }]);\n  range.then(result => {\n    let templateData = {\n      t: \"rect\",\n      user: game.user._id,\n      distance: 7,\n      direction: 45,\n      x: 0,\n      y: 0,\n      flags: {\n        DAESRD: {\n          SpiritualWeapon: {\n            ActorId: tactor.id\n          }\n        }\n      },\n      fillColor: game.user.color\n    }\n    Hooks.once(\"createMeasuredTemplate\", deleteTemplates);\n\n    let doc = new CONFIG.MeasuredTemplate.documentClass(templateData, { parent: canvas.scene })\n    let template = new game.dnd5e.canvas.AbilityTemplate(doc)\n    template.actorSheet = tactor.sheet;\n    template.drawPreview()\n\n    async function deleteTemplates() {\n      let removeTemplates = canvas.templates.placeables.filter(i => i.data.flags.DAESRD?.SpiritualWeaponRange?.ActorId === tactor.id);\n      await canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\", [removeTemplates[0].id]);\n    };\n  })\n  await tactor.createOwnedItem(\n    {\n      \"name\": \"Summoned Spiritual Weapon\",\n      \"type\": \"weapon\",\n      \"data\": {\n        \"equipped\": true,\n        \"identified\": true,\n        \"activation\": {\n          \"type\": \"bonus\",\n        },\n        \"target\": {\n          \"value\": 1,\n          \"width\": null,\n          \"type\": \"creature\"\n        },\n        \"range\": {\n          \"value\": 5,\n          \"units\": \"ft\"\n        },\n        \"ability\": args[2],\n        \"actionType\": \"msak\",\n        \"attackBonus\": \"0\",\n        \"chatFlavor\": \"\",\n        \"critical\": null,\n        \"damage\": {\n          \"parts\": [\n            [\n              `${damage}d8+@mod`,\n              \"force\"\n            ]\n          ],\n        },\n        \"weaponType\": \"simpleM\",\n        \"proficient\": true\n      },\n      \"flags\": {\n        \"DAESRD\": {\n          \"SpiritualWeapon\":\n            target.actor.id\n        }\n      },\n      \"img\": `${image}`,\n      \"effects\" : []\n    },\n  );\n  ui.notifications.notify(\"Weapon created in your inventory\")\n\n}\n\n// Delete Spitirual Weapon and template\nif (args[0] === \"off\") {\n  let removeItem = tactor.items.find(i => i.data.flags?.DAESRD?.SpiritualWeapon === tactor.id)\n  let template = canvas.templates.placeables.find(i => i.data.flags.DAESRD.SpiritualWeapon?.ActorId === tactor.id)\n  if(removeItem) await tactor.deleteOwnedItem(removeItem.id);\n  if(template) await canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\", [template.id])\n}","author":"zrPR3wueYsESSBR3","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"permission":{"default":0},"flags":{}},"options":{},"apps":{},"compendium":null}},"cf":{"id":"temp_xbat54h1eir"},"core":{"sourceId":"Compendium.world.ddb-candlekeep-adventures-spells.kXZRjh0oLMFA1LVR"},"advancedspelleffects":{"enableASE":true},"enhancedcombathud":{"set1p":false,"set2p":false,"set3p":false},"targetreacts":{"shakeDelay":""}},"_id":"4uoq3xFSgQDwkUH6"}
{"name":"Call Lightning","type":"spell","img":"systems/dnd5e/icons/spells/lighting-sky-2.jpg","data":{"description":{"value":"<p>A storm cloud appears in the shape of a cylinder that is 10 feet tall with a 60-foot radius, centered on a point you can see within range directly above you. The spell fails if you can’t see a point in the air where the storm cloud could appear (for example, if you are in a room that can’t accommodate the cloud).</p>\n<p>When you cast the spell, choose a point you can see under the cloud. A bolt of lightning flashes down from the cloud to that point. Each creature within 5 feet of that point must make a Dexterity saving throw. A creature takes 3d10 lightning damage on a failed save, or half as much damage on a successful one. On each of your turns until the spell ends, you can use your action to call down lightning in this way again, targeting the same point or a different one.</p>\n<p>If you are outdoors in stormy conditions when you cast this spell, the spell gives you control over the existing storm instead of creating a new one. Under such conditions, the spell’s damage increases by 1d10.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 4th or higher level, the damage increases by 1d10 for each slot level above 3rd.</p>","chat":"<p>A storm cloud appears in the shape of a cylinder that is 10 feet tall with a 60-foot radius, centered on a point you can see within range directly above you. The spell fails if you can’t see a point in the air where the storm cloud could appear (for example, if you are in a room that can’t accommodate the cloud).</p>\n<p>When you cast the spell, choose a point you can see under the cloud. A bolt of lightning flashes down from the cloud to that point. Each creature within 5 feet of that point must make a Dexterity saving throw. A creature takes 3d10 lightning damage on a failed save, or half as much damage on a successful one. On each of your turns until the spell ends, you can use your action to call down lightning in this way again, targeting the same point or a different one.</p>\n<p>If you are outdoors in stormy conditions when you cast this spell, the spell gives you control over the existing storm instead of creating a new one. Under such conditions, the spell’s damage increases by 1d10.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 4th or higher level, the damage increases by 1d10 for each slot level above 3rd.</p>","unidentified":""},"source":"Basic Rules, Player's Handbook pg 220","activation":{"type":"action","cost":1,"condition":""},"duration":{"value":10,"units":"minute"},"target":{"value":null,"width":null,"units":"","type":""},"range":{"value":null,"long":null,"units":""},"uses":{"value":0,"max":"0","per":""},"consume":{"type":"","target":"","amount":null},"ability":"","actionType":"other","attackBonus":0,"chatFlavor":"","critical":null,"damage":{"parts":[],"versatile":""},"formula":"","save":{"ability":"","dc":null,"scaling":"spell"},"level":3,"school":"con","components":{"value":"","vocal":true,"somatic":true,"material":false,"ritual":false,"concentration":true},"materials":{"value":"","consumed":false,"cost":0,"supply":0},"preparation":{"mode":"prepared","prepared":false},"scaling":{"mode":"none","formula":""}},"effects":[{"_id":"xfVuiySO5CUntl2N","flags":{"dae":{"stackable":false,"specialDuration":"None","transfer":false}},"changes":[{"key":"macro.itemMacro","value":"@target @item.level","mode":0,"priority":20}],"disabled":false,"duration":{"startTime":null},"icon":"systems/dnd5e/icons/spells/lighting-sky-2.jpg","label":"Call Lightning Summon","tint":null,"transfer":false}],"folder":null,"sort":0,"permission":{"default":0,"FEWmZGWq8JJmEjb4":3},"flags":{"ddbimporter":{"id":136172,"definitionId":2022,"entityTypeId":435869154,"dndbeyond":{"lookup":"generic","lookupName":"generic","level":null,"castAtLevel":null},"sources":[{"sourceId":1,"pageNumber":null,"sourceType":2},{"sourceId":2,"pageNumber":220,"sourceType":1}],"tags":["Damage"]},"betterRolls5e":{"quickVersatile":{"altValue":true},"quickCharges":{"value":{"use":true,"resource":true},"altValue":{"use":true,"resource":true}}},"dae":{"activeEquipped":false,"alwaysActive":false},"midi-qol":{"onUseMacroName":""},"itemacro":{"macro":{"_data":{"name":"Call Lightning","type":"script","scope":"global","command":"//DAE Macro Execute, Effect Value = \"Macro Name\" \nconst lastArg = args[args.length - 1];\nlet tactor;\nif (lastArg.tokenId) tactor = canvas.tokens.get(lastArg.tokenId).actor;\nelse tactor = game.actors.get(lastArg.actorId);\n\nconst DAEitem = lastArg.efData.flags.dae.itemData\nconst saveData = DAEitem.data.save\n/**\n * Create Call Lightning Bolt item in inventory\n */\nif (args[0] === \"on\") {\n    let templateData = {\n        t: \"circle\",\n        user: game.user._id,\n        distance: 60,\n        direction: 0,\n        x: 0,\n        y: 0,\n        flags: {\n            DAESRD: {\n                CallLighting: {\n                    ActorId: tactor.id\n                }\n            }\n        },\n        fillColor: game.user.color\n    }\n    let template = new game.dnd5e.canvas.AbilityTemplate(templateData)\n    template.actorSheet = tactor.sheet;\n    template.drawPreview()\n    await tactor.createOwnedItem(\n        {\n            \"name\": \"Call Lightning - bolt\",\n            \"type\": \"spell\",\n            \"data\": {\n              \"description\": {\n                \"value\": \"<p><span style=\\\"color: #191813; font-size: 13px;\\\">A bolt of lightning flashes down from the cloud to that point. Each creature within 5 feet of that point must make a Dexterity saving throw. A creature takes 3d10 lightning damage on a failed save, or half as much damage on a successful one.</span></p>\"\n              },\n              \"activation\": {\n                \"type\": \"action\"\n              },\n              \"target\": {\n                \"value\": 5,\n                \"width\": null,\n                \"units\": \"ft\",\n                \"type\": \"radius\"\n              },\n              \"ability\": \"\",\n              \"actionType\": \"save\",\n              \"damage\": {\n                \"parts\": [\n                  [\n                    `${DAEitem.data.level}d10`,\n                    \"lightning\"\n                  ]\n                ],\n                \"versatile\": \"\"\n              },\n              \"formula\": \"\",\n              \"save\": {\n                \"ability\": \"dex\",\n                \"dc\": 16,\n                \"scaling\": \"spell\"\n              },\n              \"level\": 0,\n              \"school\": \"abj\",\n              \"preparation\": {\n                \"mode\": \"prepared\",\n                \"prepared\": false\n              },\n              \"scaling\": {\n                \"mode\": \"none\",\n                \"formula\": \"\"\n              }\n            },\n            \"img\": \"systems/dnd5e/icons/spells/lighting-sky-2.jpg\"\n          }\n    );\n}\n\n// Delete Flame Blade\nif (args[0] === \"off\") {\n    let castItem = tactor.data.items.find(i => i.name === \"Call Lightning - bolt\" && i.type === \"spell\")\n    if(castItem) await tactor.deleteOwnedItem(castItem._id)\n    let template = canvas.templates.placeables.filter(i => i.data.flags.DAESRD?.CallLighting?.ActorId === tactor.id)\n    if(template) await canvas.templates.deleteMany(template[0].id)\n\n}","author":"E4BVikjIkVl2lL2j"},"data":{"name":"Call Lightning","type":"script","scope":"global","command":"//DAE Macro no arguments passed\nif (!game.modules.get(\"advanced-macros\")?.active) ui.notifications.error(\"Please enable the Advanced Macros module\")\n\nconst lastArg = args[args.length - 1];\nlet tactor;\nif (lastArg.tokenId) tactor = canvas.tokens.get(lastArg.tokenId).actor;\nelse tactor = game.actors.get(lastArg.actorId);\n\nconst DAEitem = lastArg.efData.flags.dae.itemData\nconst saveData = DAEitem.data.save\n/**\n * Create Call Lightning Bolt item in inventory\n */\nif (args[0] === \"on\") {\n    let templateData = {\n        t: \"circle\",\n        user: game.user._id,\n        distance: 60,\n        direction: 0,\n        x: 0,\n        y: 0,\n        flags: {\n            DAESRD: {\n                CallLighting: {\n                    ActorId: tactor.id\n                }\n            }\n        },\n        fillColor: game.user.color\n    }\n    let doc = new CONFIG.MeasuredTemplate.documentClass(templateData, { parent: canvas.scene })\n    let template = new game.dnd5e.canvas.AbilityTemplate(doc)\n    template.actorSheet = tactor.sheet;\n    template.drawPreview()\n\n    await tactor.createOwnedItem(\n        {\n            \"name\": \"Call Lightning - bolt\",\n            \"type\": \"spell\",\n            \"data\": {\n              \"description\": {\n                \"value\": \"<p><span style=\\\"color: #191813; font-size: 13px;\\\">A bolt of lightning flashes down from the cloud to that point. Each creature within 5 feet of that point must make a Dexterity saving throw. A creature takes 3d10 lightning damage on a failed save, or half as much damage on a successful one.</span></p>\"\n              },\n              \"activation\": {\n                \"type\": \"action\"\n              },\n              \"target\": {\n                \"value\": 5,\n                \"width\": null,\n                \"units\": \"ft\",\n                \"type\": \"radius\"\n              },\n              \"ability\": \"\",\n              \"actionType\": \"save\",\n              \"damage\": {\n                \"parts\": [\n                  [\n                    `${DAEitem.data.level}d10`,\n                    \"lightning\"\n                  ]\n                ],\n                \"versatile\": \"\"\n              },\n              \"formula\": \"\",\n              \"save\": {\n                \"ability\": \"dex\",\n                \"dc\": 16,\n                \"scaling\": \"spell\"\n              },\n              \"level\": 0,\n              \"school\": \"abj\",\n              \"preparation\": {\n                \"mode\": \"prepared\",\n                \"prepared\": false\n              },\n              \"scaling\": {\n                \"mode\": \"none\",\n                \"formula\": \"\"\n              }\n            },\n            \"img\": \"systems/dnd5e/icons/spells/lighting-sky-2.jpg\",\n            \"effects\" : []\n          }\n    );\n}\n\n// Delete Flame Blade\nif (args[0] === \"off\") {\n    let castItem = tactor.data.items.find(i => i.name === \"Call Lightning - bolt\" && i.type === \"spell\")\n    if(castItem) await tactor.deleteOwnedItem(castItem._id)\n    let template = canvas.templates.placeables.find(i => i.data.flags.DAESRD?.CallLighting?.ActorId === tactor.id)\n    if (template) await canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\", [template.id])\n\n}","author":"zrPR3wueYsESSBR3","_id":null,"img":"icons/svg/dice-target.svg","folder":null,"sort":0,"permission":{"default":0},"flags":{}},"options":{},"apps":{},"compendium":null}},"cf":{"id":"temp_dpq2n6d2998"},"enhancedcombathud":{"set1p":false,"set2p":false,"set3p":false},"targetreacts":{"shakeDelay":""},"core":{"sourceId":"Compendium.world.ddb-candlekeep-adventures-spells.LbJrsGxIZxU67Ett"},"advancedspelleffects":{"enableASE":true,"effectOptions":{"boltStyle":"chain"}}},"_id":"tNV0B19ga0ny9D6W"}
